FROM ubuntu:20.04 AS builder

# Update default packages
RUN apt-get update

# Get Ubuntu packages
RUN apt-get install -y \
    build-essential \
    curl

# Update new packages
RUN apt-get update

# Get Rust
RUN curl https://sh.rustup.rs -sSf | bash -s -- -y

ENV PATH="/root/.cargo/bin:${PATH}"

WORKDIR /app
COPY . .
RUN cargo build --release

FROM  alpine:3.12
WORKDIR /app
COPY --from=builder /app/target/release/webdav /usr/local/bin
ENTRYPOINT ["./usr/local/bin/webdav"]
